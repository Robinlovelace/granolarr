```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_knit$set(root.dir = Sys.getenv("GRANOLARR_HOME"))
rm(list = ls())
```



# Selection and filtering



## Recap

**Prev**: Data Frames

- Data Frames
- Tibbles

**Now**: Data selection and filtering

- dplyr
- dplyr::select
- dplyr::filter



## dplyr

The `dplyr` (pronounced *dee-ply-er*) library is part of `tidyverse` and it offers a grammar for data manipulation

- `select`: select specific columns
- `filter`: select specific rows
- `arrange`: arrange rows in a particular order
- `summarise`: calculate aggregated values (e.g., mean, max, etc)
- `group_by`: group data based on common column values
- `mutate`: add columns
- `join`: merge tables (`tibbles` or `data.frames`)

```{r, echo=TRUE, message=FALSE, warning=FALSE}
library(tidyverse)
```



## Example dataset

The library `nycflights13` contains a dataset storing data about all the flights departed from New York City in 2013
<!--
```{r, echo=TRUE, eval=FALSE}
install.packages("nycflights13")
```
-->
```{r, echo=TRUE, eval=FALSE}
library(nycflights13)

nycflights13::flights
```
```{r, echo=FALSE}
library(nycflights13)

nycflights13::flights %>% 
  print(n= 3, width = 70)
```



## dplyr::select

`select` can be used to specify which columns to retain

```{r, echo=TRUE, eval=FALSE}
nycflights13::flights %>%
  dplyr::select( 
    origin, dest, dep_delay, arr_delay, year:day
  )
```
```{r, echo=FALSE}
nycflights13::flights %>%
  dplyr::select( 
    origin, dest, dep_delay, arr_delay, year:day
  ) %>% 
  print(n = 5)
```


## dplyr::select

... or whichones to drop, using - in front of the column name

```{r, echo=TRUE, eval=FALSE}
dep_delays <- 
  nycflights13::flights %>%
  dplyr::select(origin, dest, dep_delay, arr_delay, year:day) %>% 
  dplyr::select(-arr_delay)

dep_delays
```
```{r, echo=FALSE}
dep_delays <- 
  nycflights13::flights %>%
  dplyr::select(
    origin, dest, dep_delay, arr_delay, year:day
  ) %>% 
  dplyr::select(
    -arr_delay
  )

dep_delays %>% 
  print(n = 3)
```


## Logical filtering

Conditional statements can be used to filter a vector, i.e. to retain only certain values

```{r, echo=TRUE}
a_numeric_vector <- -3:3
a_numeric_vector
a_numeric_vector[c(FALSE, FALSE, FALSE, TRUE, TRUE, TRUE, TRUE)]
```



## Conditional filtering

As a condition expression results in a logic vector, that condition can be used for filtering

```{r, echo=TRUE}
a_numeric_vector > 0
a_numeric_vector[a_numeric_vector > 0]
```



## Filtering data frames

The same can be applied to data frames

```{r, echo=TRUE, eval=FALSE}
dep_delays[dep_delays$month == 11, ]
```
```{r, echo=FALSE}
dep_delays[dep_delays$month == 11, ] %>% 
  print(n = 3)
```



## dplyr::filter

```{r, echo=TRUE, eval=FALSE}
dep_delays %>%
  dplyr::filter(month == 11) # Flights in November
```
```{r, echo=FALSE}
dep_delays %>%
  dplyr::filter(month == 11) %>%
  print(n = 3)
```



## Summary

Data selection and filtering

- dplyr
- dplyr::select
- dplyr::filter

**Next**: Data manipulation

- dplyr::arrange
- dplyr::summarise
- dplyr::group_by
- dplyr::mutate



```{r cleanup, include=FALSE}
rm(list = ls())
```